From: Dave Cheney <dave@cheney.net>
Date: Mon, 13 Apr 2015 21:50:47 +1000
Subject: cmd/dist: use gccgo as bootstrap compiler

Fixes #10092

This change makes it possible to use gccgo 5 as the GOROOT_BOOTSTRAP
compiler.

Change-Id: Ie3a312781ac1a09ea77f95b5a78c9488d437e0aa
---
 src/cmd/dist/cpuid_amd64.s |  2 ++
 src/cmd/dist/util.go       | 12 ------------
 src/cmd/dist/util_gc.go    | 19 +++++++++++++++++++
 src/cmd/dist/util_gccgo.go |  9 +++++++++
 4 files changed, 30 insertions(+), 12 deletions(-)
 create mode 100644 src/cmd/dist/util_gc.go
 create mode 100644 src/cmd/dist/util_gccgo.go

diff --git a/src/cmd/dist/cpuid_amd64.s b/src/cmd/dist/cpuid_amd64.s
index dbb1085..b6cdfed 100644
--- a/src/cmd/dist/cpuid_amd64.s
+++ b/src/cmd/dist/cpuid_amd64.s
@@ -2,6 +2,8 @@
 // Use of this source code is governed by a BSD-style
 // license that can be found in the LICENSE file.
 
+// +build !gccgo
+
 TEXT Â·cpuid(SB),$0-12
 	MOVL ax+8(FP), AX
 	CPUID
diff --git a/src/cmd/dist/util.go b/src/cmd/dist/util.go
index 0bbdbad..cae5d69 100644
--- a/src/cmd/dist/util.go
+++ b/src/cmd/dist/util.go
@@ -480,18 +480,6 @@ func xsamefile(f1, f2 string) bool {
 	return os.SameFile(fi1, fi2)
 }
 
-func cpuid(info *[4]uint32, ax uint32)
-
-func cansse2() bool {
-	if gohostarch != "386" && gohostarch != "amd64" {
-		return false
-	}
-
-	var info [4]uint32
-	cpuid(&info, 1)
-	return info[3]&(1<<26) != 0 // SSE2
-}
-
 func xgetgoarm() string {
 	if goos == "nacl" {
 		// NaCl guarantees VFPv3 and is always cross-compiled.
diff --git a/src/cmd/dist/util_gc.go b/src/cmd/dist/util_gc.go
new file mode 100644
index 0000000..9f6cfd0
--- /dev/null
+++ b/src/cmd/dist/util_gc.go
@@ -0,0 +1,19 @@
+// Copyright 2015 The Go Authors.  All rights reserved.
+// Use of this source code is governed by a BSD-style
+// license that can be found in the LICENSE file.
+
+// +build !gccgo
+
+package main
+
+func cpuid(info *[4]uint32, ax uint32)
+
+func cansse2() bool {
+	if gohostarch != "386" && gohostarch != "amd64" {
+		return false
+	}
+
+	var info [4]uint32
+	cpuid(&info, 1)
+	return info[3]&(1<<26) != 0 // SSE2
+}
diff --git a/src/cmd/dist/util_gccgo.go b/src/cmd/dist/util_gccgo.go
new file mode 100644
index 0000000..f680e7b
--- /dev/null
+++ b/src/cmd/dist/util_gccgo.go
@@ -0,0 +1,9 @@
+// Copyright 2015 The Go Authors.  All rights reserved.
+// Use of this source code is governed by a BSD-style
+// license that can be found in the LICENSE file.
+
+// +build gccgo
+
+package main
+
+func cansse2() bool { return false }
